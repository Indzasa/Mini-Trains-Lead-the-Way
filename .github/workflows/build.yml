name: Build

on:
  push:
    branches:
      - main
      - test

jobs:
  build_and_deploy_mod:
    runs-on: self-hosted
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Extract mod version
        id: extract_version
        run: |
          # Извлекаем версию мода из info.json"
          $version = Get-Content -Path "D:/Development/Mini-Trains-Lead-the-Way/info.json" | ConvertFrom-Json | Select-Object -ExpandProperty version
          echo "::set-output name=mod_version::$version"

      - name: Archive mod folder
        run: |
          # Создаем имя архива с учетом версии
          $mod_name = "Mini-Trains-Lead-the-Way"  # Замените на имя вашего мода
          $mod_version = "${{ steps.extract_version.outputs.mod_version }}"
          $archive_name = "$mod_name_$mod_version.zip"
          
          # Создаем архив в папке D:\Development
          powershell -Command "Compress-Archive -Path 'D:/Development/Mini-Trains-Lead-the-Way/*' -DestinationPath 'D:/Development/$archive_name' -Force"

      - name: Copy mod archive to Factorio mods folder
        run: |
          # Копируем архив в папку с модами Factorio
          $mod_name = "Mini-Trains-Lead-the-Way"  # Замените на имя вашего мода
          $mod_version = "${{ steps.extract_version.outputs.mod_version }}"
          $archive_name = "$mod_name_$mod_version.zip"
          
          Copy-Item -Path "D:\Development\$archive_name" -Destination "C:\Users\Indzasa\AppData\Roaming\Factorio\mods\$archive_name" -Force

